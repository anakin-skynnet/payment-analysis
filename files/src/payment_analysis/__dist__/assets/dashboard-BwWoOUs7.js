import{c as D,j as e,r as H,k as O,ao as V,ap as Q,aq as J,ar as W,as as X,_ as Y,y as o,z as l,E as x,a7 as v,H as c,B as p,L as g,A as T,ad as w,J as k,t as Z,n as ee,C as q,I as y,K as f,M as A,at as z,h as d,N as S,V as se,au as ae}from"./index-BtVhH8KW.js";import{s as _}from"./selector-DrlYLf2R.js";import{m as n}from"./proxy-2gRHNSba.js";import{G as te}from"./git-branch-D0wcVmNz.js";import{C as re}from"./circle-alert-CnGnDG1J.js";import{T as ne}from"./target-DfG8ERvj.js";const ie=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],oe=D("arrow-down-right",ie);const le=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],ce=D("arrow-up-right",le);const de=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],$=D("cpu",de),C={hidden:{opacity:0,y:16},show:{opacity:1,y:0,transition:{staggerChildren:.06,delayChildren:.1}}},i={hidden:{opacity:0,y:16},show:{opacity:1,y:0}},u=t=>S(t),F=async t=>{try{const m=await(await fetch(`/api/notebooks/notebooks/${t}/url`)).json();S(m?.url)}catch(r){console.error("Failed to open notebook:",r)}},me=()=>S(f("/sql/dashboards/executive_overview"));function xe(){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(d,{className:"h-8 w-64"}),e.jsx(d,{className:"h-4 w-96 mt-2"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:[1,2,3].map(t=>e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(d,{className:"h-4 w-24"})}),e.jsx(c,{children:e.jsx(d,{className:"h-8 w-32"})})]},t))}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(d,{className:"h-5 w-36"})}),e.jsx(c,{className:"space-y-3",children:[1,2,3,4].map(t=>e.jsx(d,{className:"h-10 w-full"},t))})]}),e.jsxs(o,{children:[e.jsx(l,{children:e.jsx(d,{className:"h-5 w-48"})}),e.jsx(c,{className:"space-y-3",children:[1,2,3,4].map(t=>e.jsx(d,{className:"h-10 w-full"},t))})]})]}),e.jsxs(o,{children:[e.jsxs(l,{children:[e.jsx(d,{className:"h-5 w-56"}),e.jsx(d,{className:"h-4 w-full mt-2"})]}),e.jsx(c,{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx(d,{className:"h-14 w-full"},t))})]})]})}function he(t){if(!t)return"—";const r=new Date(t),h=new Date().getTime()-r.getTime(),a=Math.floor(h/6e4);if(a<1)return"Just now";if(a<60)return`${a}m ago`;const N=Math.floor(a/60);return N<24?`${N}h ago`:r.toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function pe(){const{entity:t}=O(),{data:r}=V(_()),{data:m}=Q(_()),{data:h}=J(_()),{data:a}=W({params:{limit:20}}),{data:N}=X({params:{entity:t,limit:5}}),M=N?.data??[],I=(r.approval_rate*100).toFixed(2),R=a?.data??[],K=s=>ae(s.response?.reason),B=s=>s.response?.variant,G=s=>s.response?.path,U=s=>s.response?.risk_tier,j=()=>u(f("/sql/dashboards/executive_overview"));return e.jsxs(n.div,{className:"space-y-8",variants:C,initial:"hidden",animate:"show",children:[e.jsxs(n.div,{variants:i,className:"space-y-2",children:[e.jsx("p",{className:"section-label text-primary font-semibold",children:"Executive summary"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h1",{className:"page-section-title text-2xl md:text-3xl font-bold",children:"Your approval rate at a glance"}),e.jsx(Y,{})]}),e.jsx("p",{className:"page-section-description",children:"Last 30 days: portfolio approval rate, volume, and what’s driving or delaying approvals. Use the links below to drill into trends and take action."})]}),e.jsx(n.div,{variants:i,className:"content-section",children:e.jsxs(o,{className:"border-primary/20 bg-muted/30",children:[e.jsxs(l,{className:"pb-2",children:[e.jsxs(x,{className:"flex items-center gap-2 text-base",children:[e.jsx(te,{className:"w-4 h-4 text-primary"}),"One system for decisions and dashboards"]}),e.jsx(v,{children:"Smart Checkout, Reason Codes, and Smart Retry work together to increase approval rates and control risk. One flow from transactions to insights."})]}),e.jsxs(c,{className:"flex flex-wrap gap-2 pt-0",children:[e.jsx(p,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(g,{to:"/dashboards",search:{},children:["DBSQL dashboards ",e.jsx(T,{className:"w-3 h-3 ml-1"})]})}),e.jsx(p,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(g,{to:"/smart-checkout",children:"Smart Checkout"})}),e.jsx(p,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(g,{to:"/reason-codes",children:"Reason codes"})}),e.jsx(p,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(g,{to:"/smart-retry",children:"Smart Retry"})})]})]})}),e.jsxs(n.div,{variants:i,className:"content-section",children:[e.jsx("p",{className:"section-label text-muted-foreground mb-1",children:"Portfolio metrics"}),e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("h2",{className:"page-section-title",children:"Key numbers"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:me,children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Executive Dashboard",e.jsx(k,{className:"w-3 h-3 ml-2"})]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>F("gold_views_sql"),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"SQL Views",e.jsx(k,{className:"w-3 h-3 ml-2"})]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>F("realtime_pipeline"),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Lakeflow",e.jsx(k,{className:"w-3 h-3 ml-2"})]})]})]})]}),e.jsx(n.div,{variants:i,children:e.jsx("h2",{className:"sr-only",children:"At a glance"})}),e.jsxs(n.div,{variants:C,className:"grid gap-4 md:grid-cols-3",children:[e.jsx(n.div,{variants:i,className:"md:col-span-1",whileTap:{scale:.98},transition:{duration:.15},children:e.jsxs(o,{className:"kpi-card kpi-card-hero cursor-pointer relative overflow-hidden border-2 border-primary/50 bg-primary/10 hover:shadow-xl hover:shadow-primary/20 hover:border-primary/70 transition-all duration-300 elevation-2",onClick:j,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&j(),children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/15 to-transparent pointer-events-none"}),e.jsx(l,{className:"pb-2 relative",children:e.jsx(x,{className:"text-sm font-semibold text-primary",children:"Portfolio approval rate"})}),e.jsxs(c,{className:"relative",children:[e.jsxs("p",{className:"kpi-number text-4xl md:text-5xl font-bold text-primary",children:[I,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Core metric for Getnet — higher rate drives revenue and better customer experience. Click to open full Executive Dashboard."})]})]})}),e.jsx(n.div,{variants:i,children:e.jsxs(o,{className:"kpi-card cursor-pointer hover:shadow-lg hover:border-primary/30 transition-all duration-300",onClick:j,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&j(),children:[e.jsx(l,{className:"pb-2",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Total auths"})}),e.jsx(c,{children:e.jsx("p",{className:"kpi-number text-3xl font-bold",children:r.total.toLocaleString()})})]})}),e.jsx(n.div,{variants:i,children:e.jsxs(o,{className:"kpi-card cursor-pointer hover:shadow-lg hover:border-primary/30 transition-all duration-300",onClick:j,role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&j(),children:[e.jsx(l,{className:"pb-2",children:e.jsx(x,{className:"text-sm font-medium text-muted-foreground",children:"Approved"})}),e.jsx(c,{children:e.jsx("p",{className:"kpi-number text-3xl font-bold",children:r.approved.toLocaleString()})})]})})]}),e.jsx(n.div,{variants:i,children:e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3",children:"Drivers & trends"})}),e.jsxs(n.div,{variants:C,className:"grid gap-4 md:grid-cols-2",children:[e.jsx(n.div,{variants:i,children:e.jsxs(o,{className:"cursor-pointer hover:shadow-lg hover:border-primary/30 transition-all duration-300",onClick:()=>u(f("/sql/dashboards/daily_trends")),role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&u(f("/sql/dashboards/daily_trends")),children:[e.jsxs(l,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"Approval Trends (Hourly)"]}),e.jsx(v,{children:"Transaction volume and approval rates by hour"})]}),e.jsx(c,{children:m.length===0?e.jsxs("div",{className:"flex flex-col items-center gap-2 py-6 text-center",children:[e.jsx(q,{className:"h-10 w-10 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No trend data yet."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Complete setup steps 1–6; data will appear here."})]}):e.jsx("div",{className:"space-y-3",children:m.slice(0,8).map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-mono w-20 shrink-0",children:s.hour}),e.jsx("div",{className:"flex-1 mx-3",children:e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary rounded-full h-2 transition-all progress-bar-fill",style:{"--progress-pct":`${Math.min(s.approval_rate_pct,100)}%`}})})}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(y,{variant:"outline",className:"font-mono text-xs",children:[s.approval_rate_pct.toFixed(1),"%"]}),e.jsxs("span",{className:"text-xs text-muted-foreground w-16 text-right",children:[s.transaction_count.toLocaleString()," txn"]})]})]},s.hour))})})]})}),e.jsx(n.div,{variants:i,children:e.jsxs(o,{className:"cursor-pointer hover:shadow-lg hover:border-primary/30 transition-all duration-300",onClick:()=>u(f("/sql/dashboards/routing_optimization")),role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&u(f("/sql/dashboards/routing_optimization")),children:[e.jsxs(l,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4"}),"Solution Performance"]}),e.jsx(v,{children:"Approval rates by payment solution"})]}),e.jsx(c,{children:h.length===0?e.jsxs("div",{className:"flex flex-col items-center gap-2 py-6 text-center",children:[e.jsx(w,{className:"h-10 w-10 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No solution data yet."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Run the pipeline to see performance by solution."})]}):e.jsx("div",{className:"space-y-3",children:h.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:s.payment_solution}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.transaction_count.toLocaleString()," transactions · avg $",s.avg_amount.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-3 shrink-0",children:[s.approval_rate_pct>=80?e.jsx(ce,{className:"w-3 h-3 text-green-600"}):e.jsx(oe,{className:"w-3 h-3 text-red-500"}),e.jsxs(y,{variant:s.approval_rate_pct>=80?"default":s.approval_rate_pct>=60?"secondary":"destructive",children:[s.approval_rate_pct.toFixed(1),"%"]})]})]},s.payment_solution))})})]})})]}),e.jsxs(n.div,{variants:i,children:[e.jsx("p",{className:"section-label text-muted-foreground mb-1",children:"Recommended actions"}),e.jsxs(o,{className:"business-value-card border-l-4 border-l-primary border-amber-200/80 dark:border-amber-800/80 bg-amber-50/40 dark:bg-amber-950/30 shadow-md",children:[e.jsxs(l,{children:[e.jsxs(x,{className:"flex items-center gap-2 text-base",children:[e.jsx(re,{className:"w-4 h-4 text-amber-600 dark:text-amber-400"}),"Factors that may be delaying approvals"]}),e.jsx(v,{children:"Top conditions from Reason Codes with recommended actions. Act on these to accelerate approval rates."})]}),e.jsxs(c,{children:[M.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No reason-code data yet. Run gold views and Reason Codes pipeline; then open Reason Codes for full insights."}):e.jsx("ul",{className:"space-y-3",children:M.map(s=>e.jsxs("li",{className:"flex items-start gap-3 rounded-lg border border-border/60 p-2.5",children:[e.jsx(ne,{className:"w-4 h-4 shrink-0 text-primary mt-0.5"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s.decline_reason_standard}),e.jsx("p",{className:"text-xs text-muted-foreground mt-0.5",children:s.recommended_action}),s.estimated_recoverable_value!=null&&s.estimated_recoverable_value>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-0.5",children:["Est. recoverable: $",s.estimated_recoverable_value.toFixed(2)]})]})]},`${s.entry_system}-${s.decline_reason_standard}-${s.priority}`))}),e.jsx(p,{variant:"outline",size:"sm",className:"mt-3",asChild:!0,children:e.jsxs(g,{to:"/reason-codes",children:["View all Reason Codes ",e.jsx(T,{className:"w-3 h-3 ml-1"})]})})]})]})]}),e.jsx(n.div,{variants:i,children:e.jsx("h2",{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3",children:"Where to act"})}),e.jsx(n.div,{variants:i,children:e.jsx(je,{})}),e.jsx(n.div,{variants:i,children:e.jsxs(o,{className:"cursor-pointer hover:shadow-lg hover:border-primary/30 transition-all duration-300",onClick:()=>u(z()),role:"button",tabIndex:0,onKeyDown:s=>s.key==="Enter"&&u(z()),children:[e.jsxs(l,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4"}),"ML & decision reasoning"]}),e.jsx(v,{children:"Recent policy and model reasoning from authentication, retry, and routing decisions"})]}),e.jsx(c,{children:R.length===0?e.jsxs("div",{className:"flex flex-col items-center gap-2 py-6 text-center",children:[e.jsx(A,{className:"h-10 w-10 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent decisions."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use the Decisioning playground to generate decisions and reasoning."})]}):e.jsx("ul",{className:"space-y-4",children:R.slice(0,15).map(s=>{const P=K(s),b=B(s),L=G(s),E=U(s);return e.jsxs("li",{className:"border-b border-border/60 pb-4 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx(y,{variant:"secondary",className:"font-mono text-xs",children:s.decision_type}),(b??L??E)&&e.jsx("span",{className:"text-xs text-muted-foreground",children:[b&&`A/B: ${b}`,L,E].filter(Boolean).join(" · ")}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto",children:he(s.created_at)})]}),e.jsx("p",{className:"text-sm text-foreground",children:P})]},s.audit_id??s.id??Math.random())})})})]})})]})}async function ue(t=50){const r=await fetch(`/api/analytics/online-features?limit=${t}`);if(!r.ok)throw new Error(r.statusText);return r.json()}function je(){const{data:t,isLoading:r,isError:m}=se({queryKey:["/api/analytics/online-features",50],queryFn:()=>ue(50)}),h=t??[];return e.jsxs(o,{children:[e.jsxs(l,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Online features (Lakehouse)"]}),e.jsx(v,{children:"Features from ML and AI stored in the Lakehouse (Setup & Run step 4: run lakehouse_bootstrap.sql). Populate from jobs or decisioning."})]}),e.jsxs(c,{children:[r&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(a=>e.jsx(d,{className:"h-10 w-full"},a))}),m&&e.jsx("p",{className:"text-sm text-destructive",children:"Failed to load online features."}),!r&&!m&&h.length===0&&e.jsxs("div",{className:"flex flex-col items-center gap-2 py-6 text-center",children:[e.jsx($,{className:"h-10 w-10 text-muted-foreground/50"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No features yet."}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Complete Setup & Run step 4 (run lakehouse_bootstrap.sql), then populate from ML or agent jobs."})]}),!r&&!m&&h.length>0&&e.jsx("ul",{className:"space-y-2",children:h.slice(0,20).map(a=>e.jsxs("li",{className:"flex flex-wrap items-center gap-2 rounded border px-3 py-2 text-sm",children:[e.jsx(y,{variant:a.source==="ml"?"default":"secondary",children:a.source}),a.feature_set&&e.jsx("span",{className:"text-muted-foreground",children:a.feature_set}),e.jsx("span",{className:"font-medium",children:a.feature_name}),a.feature_value!=null&&e.jsxs("span",{className:"text-muted-foreground",children:["= ",a.feature_value]}),a.feature_value_str!=null&&e.jsxs("span",{className:"text-muted-foreground",children:["= ",a.feature_value_str]}),a.entity_id&&e.jsxs("span",{className:"text-xs text-muted-foreground truncate",children:["(",a.entity_id,")"]})]},a.id))})]})]})}const we=()=>e.jsx(H.Suspense,{fallback:e.jsx(xe,{}),children:e.jsx(pe,{})});export{we as component};
