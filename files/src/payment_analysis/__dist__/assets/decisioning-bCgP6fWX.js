import{j as e,r as v,al as b,am as w,an as k,V as _,B as o,o as C,J as g,n as R,y as d,z as m,E as x,a7 as D,H as u,L as f,A as N,t as S,h as L,I as p,N as A}from"./index-BTCHrVpo.js";import{I as l}from"./input-DrSePQoi.js";import{T as E}from"./target-bULAYQ82.js";import{S as B}from"./sparkles-Bm24Pjgd.js";const j=async a=>{try{const r=await(await fetch(`/api/notebooks/notebooks/${a}/url`)).json();A(r?.url)}catch(t){console.error("Failed to open notebook:",t)}};async function F(a=20){const t=await fetch(`/api/analytics/recommendations?limit=${a}`);if(!t.ok)throw new Error(t.statusText);return t.json()}function T(){const[a,t]=v.useState({merchant_id:"m_demo",amount_minor:1999,currency:"USD",network:"visa",card_bin:"411111",issuer_country:"US",entry_mode:"ecom",is_recurring:!1,attempt_number:0,risk_score:.3,device_trust_score:.95,supports_passkey:!0,metadata:{}}),r=b(),i=w(),c=k(),n=_({queryKey:["/api/analytics/recommendations",20],queryFn:()=>F(20)});return e.jsxs("div",{className:"space-y-6",children:[e.jsx("header",{className:"page-header",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"section-label text-primary font-semibold mb-1",children:"Decisioning"}),e.jsx("h1",{className:"page-section-title text-2xl md:text-3xl font-bold",children:"Recommendations & decisions"}),e.jsx("p",{className:"mt-1 text-base font-medium text-primary",children:"How to accelerate approval rates — policies, rules, and similar-case recommendations"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Test ML-powered policies for authentication, retry, and routing. Use Rules (Lakehouse) and similar-case recommendations to accelerate approvals."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>j("train_models"),children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"ML Models",e.jsx(g,{className:"w-3 h-3 ml-2"})]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>j("agent_framework"),children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Agent Framework",e.jsx(g,{className:"w-3 h-3 ml-2"})]})]})]})}),e.jsxs(d,{className:"business-value-card content-section border-l-4 border-l-primary border-primary/25 bg-gradient-to-r from-primary/10 to-primary/5 shadow-md",children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2 text-lg font-semibold text-foreground",children:[e.jsx(E,{className:"w-5 h-5 text-primary shrink-0"}),"How to accelerate approval rates"]}),e.jsx(D,{className:"text-base",children:"This app automates and recommends actions to increase approvals. Use all of the following:"})]}),e.jsxs(u,{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium shrink-0",children:"1."}),e.jsx("span",{children:"Run authentication, retry, and routing decisions below — they apply policies that reduce friction and recover soft declines."})]}),e.jsxs("p",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium shrink-0",children:"2."}),e.jsxs("span",{children:["Define and apply ",e.jsxs(f,{to:"/rules",className:"text-primary hover:underline inline-flex items-center gap-1",children:["Rules ",e.jsx(N,{className:"w-3 h-3"})]})," (Lakehouse). AI agents and batch jobs use them to accelerate approvals."]})]}),e.jsxs("p",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium shrink-0",children:"3."}),e.jsxs("span",{children:["Follow the ",e.jsx("strong",{children:"recommendations"})," in the card below — they come from similar cases (Vector Search) and rules."]})]}),e.jsxs("p",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium shrink-0",children:"4."}),e.jsxs("span",{children:["Act on ",e.jsxs(f,{to:"/reason-codes",className:"text-primary hover:underline inline-flex items-center gap-1",children:["Reason Codes ",e.jsx(N,{className:"w-3 h-3"})]})," insights to fix conditions that delay approvals (e.g. issuer, decline reason)."]})]})]})]}),e.jsxs(d,{children:[e.jsx(m,{children:e.jsx(x,{children:"Context"})}),e.jsxs(u,{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Merchant"}),e.jsx(l,{value:a.merchant_id,onChange:s=>t({...a,merchant_id:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Amount (minor)"}),e.jsx(l,{type:"number",value:a.amount_minor,onChange:s=>t({...a,amount_minor:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Currency"}),e.jsx(l,{value:a.currency,onChange:s=>t({...a,currency:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Risk score (0-1)"}),e.jsx(l,{type:"number",step:"0.01",value:a.risk_score??0,onChange:s=>t({...a,risk_score:Number(s.target.value)})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"A/B Experiment ID (optional)"}),e.jsx(l,{placeholder:"e.g. experiment-uuid",value:a.experiment_id??"",onChange:s=>t({...a,experiment_id:s.target.value||void 0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm text-muted-foreground",children:"Subject key (optional, default: merchant_id)"}),e.jsx(l,{placeholder:"default: merchant_id",value:a.subject_key??"",onChange:s=>t({...a,subject_key:s.target.value||void 0})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 md:col-span-2",children:[e.jsx(o,{onClick:()=>r.mutate(a),disabled:r.isPending,children:"Decide authentication"}),e.jsx(o,{variant:"secondary",onClick:()=>i.mutate(a),disabled:i.isPending,children:"Decide retry"}),e.jsx(o,{variant:"secondary",onClick:()=>c.mutate(a),disabled:c.isPending,children:"Decide routing"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(h,{title:"Authentication",result:r.data?.data,notebookId:"agent_framework"}),e.jsx(h,{title:"Retry",result:i.data?.data,notebookId:"agent_framework"}),e.jsx(h,{title:"Routing",result:c.data?.data,notebookId:"agent_framework"})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Similar cases & recommendations (Lakehouse)"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Recommendations from the Lakehouse (run lakehouse_bootstrap.sql in Setup & Run step 4). Use with Rules to accelerate approval rates."})]}),e.jsxs(u,{children:[n.isLoading&&e.jsx("div",{className:"space-y-2",children:[1,2,3].map(s=>e.jsx(L,{className:"h-16 w-full"},s))}),n.isError&&e.jsx("p",{className:"text-sm text-destructive",children:"Failed to load recommendations."}),n.data&&n.data.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recommendations yet. Run the gold views and populate approval_recommendations in the Lakehouse."}),n.data&&n.data.length>0&&e.jsx("ul",{className:"space-y-3",children:n.data.map(s=>e.jsxs("li",{className:"flex items-start gap-3 rounded-lg border p-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium",children:s.context_summary}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.recommended_action})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsxs(p,{variant:s.source_type==="vector_search"?"default":"secondary",className:"gap-1",children:[s.source_type==="vector_search"?e.jsx(B,{className:"w-3 h-3"}):null,s.source_type]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[(s.score*100).toFixed(0),"%"]})]})]},s.id))})]})]})]})}function h({title:a,result:t,notebookId:r}){const i=typeof t=="object"&&t!=null?t:null,c=i?.variant,n=i?.experiment_id,s=()=>r&&j(r);return e.jsxs(d,{className:r?"cursor-pointer hover:shadow-md transition-shadow":void 0,onClick:r?s:void 0,role:r?"button":void 0,tabIndex:r?0:void 0,onKeyDown:r?y=>y.key==="Enter"&&s():void 0,children:[e.jsxs(m,{children:[e.jsxs(x,{className:"flex items-center justify-between flex-wrap gap-2",children:[e.jsx("span",{children:a}),e.jsxs("div",{className:"flex items-center gap-2",children:[c!=null&&e.jsxs(p,{variant:"secondary",children:["A/B: ",c]}),i?.audit_id!=null&&e.jsx(p,{variant:"outline",children:String(i.audit_id)})]})]}),n!=null&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Experiment: ",n]})]}),e.jsx(u,{children:t?e.jsx("pre",{className:"text-xs whitespace-pre-wrap break-words",children:JSON.stringify(t,null,2)}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Run a decision to see output and an audit id."})})]})}const q=()=>e.jsx(T,{});export{q as component};
