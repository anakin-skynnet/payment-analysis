import{j as e,k as I,a1 as P,a2 as T,a3 as F,a4 as R,r as a,y as n,z as p,E as g,H as r,I as t,B as j,J as D,K as L,N as M}from"./index-CxQcrJOo.js";import{I as f}from"./input-B4Jz6yEC.js";import{C as z}from"./circle-check-MNpJzsmW.js";import{T as W}from"./triangle-alert-Bofq0thS.js";import{T as A}from"./target-4fNQF0Ha.js";const B=i=>M(i),U=[{system:"PD (Digital Platform)",pct:"~62%",desc:"Monthly volume"},{system:"WS (WebService)",pct:"~34%",desc:"Monthly volume"},{system:"SEP",pct:"~3%",desc:"Single Entry Point"},{system:"Checkout",pct:"~1%",desc:"Monthly volume"}],$=["Consolidate declines across Checkout, PD, WS, SEP into one view","Standardize decline reasons into a single taxonomy (reason codes)","Identify approval-rate degradation patterns and root causes","Translate patterns into actionable insights with recommended actions and estimated uplift","Feedback loop: capture expert reviews and results to improve model accuracy"];function G(){const{entity:i}=I(),o=P({params:{entity:i}}),c=T({params:{entity:i,limit:30}}),d=F({params:{days:30}}),m=R(),[x,C]=a.useState(""),[h,k]=a.useState(""),[b,E]=a.useState("valid"),[u,y]=a.useState(""),[v,l]=a.useState(null),N=c.data?.data??[],_=o.data?.data??[],w=d.data?.data??[];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold font-heading tracking-tight text-foreground",children:"Reason Codes"}),e.jsx("p",{className:"mt-1 text-sm font-medium text-primary",children:"Identify reasons and factors impacting approval rates"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Unified decline intelligence · Brazil · Full e‑commerce visibility across entry systems"}),e.jsx("p",{className:"mt-3 text-sm text-muted-foreground max-w-2xl",children:"Consolidate declines from Checkout, PD, WS, and SEP into one view; standardize reason codes and get recommended actions to accelerate approvals. Data is mapped from four entry systems that act as gates for merchant transactions."})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-3",children:"Entry systems & transaction distribution"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Brazil, monthly view. Checkout, PD, WS, and SEP return the final response to the merchant; consolidation must avoid double-counting."}),e.jsx("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-4 mb-4",children:U.map(s=>e.jsxs(n,{className:"border-border/80",children:[e.jsx(p,{className:"pb-1",children:e.jsx(g,{className:"text-sm font-medium text-muted-foreground",children:s.system})}),e.jsxs(r,{children:[e.jsx("p",{className:"text-xl font-semibold tabular-nums",children:s.pct}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.desc})]})]},s.system))}),e.jsxs(n,{className:"border-border/80",children:[e.jsx(p,{children:e.jsx(g,{className:"text-base",children:"Entry system coverage (live data)"})}),e.jsx(r,{className:"space-y-2",children:o.isLoading?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"}):o.isError?e.jsx("p",{className:"text-sm text-destructive",children:"Failed to load entry system distribution."}):_.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No data yet."}):_.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border/50 last:border-0",children:[e.jsx(t,{variant:"secondary",children:s.entry_system}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Approval ",s.approval_rate_pct,"%"]}),e.jsxs(t,{variant:"outline",children:[s.transaction_count," tx"]})]})]},s.entry_system))})]}),e.jsxs(j,{variant:"outline",size:"sm",className:"mt-3 gap-2",onClick:()=>B(L("/sql/dashboards/decline_analysis")),children:["Open decline analysis dashboard ",e.jsx(D,{className:"h-3.5 w-3.5"})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-3",children:"Intelligence layer – what we deliver"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"A data- and AI-driven layer that supports descriptive, diagnostic, and prescriptive decision making."}),e.jsx("ul",{className:"space-y-2",children:$.map((s,S)=>e.jsxs("li",{className:"flex items-start gap-2 text-sm",children:[e.jsx(z,{className:"h-4 w-4 shrink-0 text-primary mt-0.5"}),e.jsx("span",{className:"text-muted-foreground",children:s})]},S))})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-3",children:"Counter metric: False Insights"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Percentage of insights marked as invalid or non‑actionable by domain specialists after review. Keeps speed vs. accuracy balanced and embeds expert validation in the learning loop."}),e.jsxs(n,{className:"border-border/80",children:[e.jsx(p,{children:e.jsxs(g,{className:"text-base flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-amber-500"}),"False insights rate (quality control)"]})}),e.jsx(r,{className:"space-y-2",children:d.isLoading?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"}):d.isError?e.jsx("p",{className:"text-sm text-destructive",children:"Failed to load metric."}):w.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No feedback data yet. Expert reviews populate this metric."}):w.map(s=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border/50 last:border-0",children:[e.jsx("span",{className:"text-sm font-mono",children:s.event_date}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(t,{variant:(s.false_insights_pct??0)>20?"destructive":"secondary",children:[s.false_insights_pct??0,"% false"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.false_insights,"/",s.reviewed_insights," reviewed"]})]})]},s.event_date))})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-3",children:"Insights & recommended actions"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Top standardized decline reasons with suggested remediation and estimated recoverable value."}),e.jsx(n,{className:"border-border/80",children:e.jsx(r,{className:"pt-6 space-y-4",children:c.isLoading?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading…"}):c.isError?e.jsx("p",{className:"text-sm text-destructive",children:"Failed to load reason codes."}):N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No data yet. Run the simulator and ETL to populate views."}):N.map(s=>e.jsxs("div",{className:"rounded-lg border border-border/60 p-3 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm font-medium",children:s.decline_reason_standard}),e.jsx(t,{variant:"outline",children:s.decline_reason_group}),e.jsx(t,{variant:"secondary",children:s.entry_system}),e.jsx(t,{variant:"secondary",children:s.flow_type}),s.pct_of_declines!=null&&e.jsxs(t,{children:[s.pct_of_declines,"% of declines"]}),e.jsxs(t,{variant:"outline",children:["Priority ",s.priority]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.jsx(A,{className:"h-3.5 w-3.5 inline mr-1"}),"Action: ",s.recommended_action]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Est. recoverable: ",s.estimated_recoverable_declines," declines · $",s.estimated_recoverable_value.toFixed(2)]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(t,{variant:"secondary",children:[s.decline_count," declines"]})})]},`${s.entry_system}-${s.flow_type}-${s.decline_reason_standard}-${s.priority}`))})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-semibold text-foreground mb-3",children:"Expert review (learning loop)"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Mark an insight as valid, invalid, or non‑actionable. This updates the False Insights counter‑metric and improves future recommendations."}),e.jsx(n,{className:"border-border/80",children:e.jsxs(r,{className:"pt-6 space-y-4",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Insight ID"}),e.jsx(f,{value:x,onChange:s=>C(s.target.value),placeholder:"ins-001"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Reviewer"}),e.jsx(f,{value:h,onChange:s=>k(s.target.value),placeholder:"analyst@company.com"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Verdict"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["valid","invalid","non_actionable"].map(s=>e.jsx(j,{type:"button",variant:b===s?"default":"secondary",onClick:()=>E(s),children:s.replace("_"," ")},s))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-muted-foreground",children:"Reason (optional)"}),e.jsx(f,{value:u,onChange:s=>y(s.target.value),placeholder:"Why is this insight invalid or non-actionable?"})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(j,{type:"button",disabled:m.isPending||x.trim().length===0,onClick:async()=>{l(null);try{(await m.mutateAsync({insight_id:x.trim(),insight_type:"reason_code_insight",verdict:b,reviewer:h.trim().length?h.trim():null,reason:u.trim().length?u.trim():null,model_version:null,prompt_version:null})).data.accepted?(l("Submitted. Thanks — counter-metric will update shortly."),y(""),await d.refetch()):l("Not accepted (Databricks unavailable). Configure workspace access and retry.")}catch{l("Failed to submit feedback.")}},children:m.isPending?"Submitting…":"Submit review"}),v&&e.jsx("span",{className:"text-sm text-muted-foreground",children:v})]})]})})]})]})}const V=()=>e.jsx(G,{});export{V as component};
