import{c as C,j as e,k as _,ab as M,_ as R,B as l,n as h,J as o,o as j,y as c,H as d,z as p,h as x,E as u,a7 as f,I as v,N as t,q as i,ac as N,s as L,ad as F}from"./index-BTCHrVpo.js";import{C as z}from"./circle-alert-DBZAy6Dz.js";import{R as E}from"./rotate-ccw-CrsZElZf.js";const U=[["path",{d:"m10.586 5.414-5.172 5.172",key:"4mc350"}],["path",{d:"m18.586 13.414-5.172 5.172",key:"8c96vv"}],["path",{d:"M6 12h12",key:"8npq4p"}],["circle",{cx:"12",cy:"20",r:"2",key:"144qzu"}],["circle",{cx:"12",cy:"4",r:"2",key:"muu5ef"}],["circle",{cx:"20",cy:"12",r:"2",key:"1xzzfp"}],["circle",{cx:"4",cy:"12",r:"2",key:"1hvhnz"}]],D=C("waypoints",U),w=async n=>{try{const m=await(await fetch(`/api/notebooks/notebooks/${n}/url`)).json();t(m?.url)}catch(a){console.error("Failed to open notebook:",a)}},I=async n=>{try{const m=await(await fetch(`/api/notebooks/notebooks/folders/${n}/url`)).json();t(m?.url)}catch(a){console.error("Failed to open folder:",a)}},T=()=>t(N()),g=n=>{const a=i();a&&n&&t(`${a}/ml/models/${n}`)},S={approval_propensity:e.jsx(F,{className:"w-5 h-5"}),risk_scoring:e.jsx(L,{className:"w-5 h-5"}),smart_routing:e.jsx(D,{className:"w-5 h-5"}),smart_retry:e.jsx(E,{className:"w-5 h-5"})},$={approval_propensity:"text-green-500",risk_scoring:"text-red-500",smart_routing:"text-blue-500",smart_retry:"text-purple-500"};function q(){const{entity:n}=_(),{data:a,isLoading:m,isError:k,error:y}=M({params:{entity:n}}),b=a?.data??[];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("h1",{className:"page-section-title text-2xl font-semibold",children:"ML Models"}),e.jsx(R,{label:"From UC & MLflow"})]}),e.jsxs("p",{className:"page-section-description",children:["Four models (approval propensity, risk, routing, retry) from Setup & Run step 7. All are ",e.jsx("strong",{children:"RandomForestClassifier"})," (scikit-learn), trained in one MLflow experiment on UC data; use in Decisioning and with Rules."]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>I("ml"),children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Open ML folder in Workspace",e.jsx(o,{className:"w-3 h-3 ml-2"})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>w("train_models"),children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Training Notebook",e.jsx(o,{className:"w-3 h-3 ml-2"})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:T,children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"MLflow Experiments",e.jsx(o,{className:"w-3 h-3 ml-2"})]})]})]})}),e.jsx(c,{className:"border-primary/20 bg-primary/5",children:e.jsx(d,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-primary mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Model types: all four are RandomForestClassifier (scikit-learn), trained and registered to Unity Catalog"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Each card shows the purpose of the model experiment, feature set, and catalog path. The backend uses your Databricks config (catalog/schema). Open ",e.jsx("strong",{children:"MLflow"})," or ",e.jsx("strong",{children:"Model Registry"})," for latest run metrics, or use ",e.jsx("strong",{children:"Decisioning"})," for live predictions."]})]})]})})}),k&&e.jsx(c,{className:"border-destructive/50 bg-destructive/5",children:e.jsxs(d,{className:"py-6 flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-destructive shrink-0"}),e.jsxs("p",{className:"text-sm text-destructive",children:["Failed to load models: ",y instanceof Error?y.message:"Unknown error"]})]})}),m?e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:[1,2,3,4].map(s=>e.jsxs(c,{children:[e.jsxs(p,{children:[e.jsx(x,{className:"h-5 w-3/4"}),e.jsx(x,{className:"h-4 w-full mt-2"})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsx(x,{className:"h-6 w-1/3"}),e.jsx(x,{className:"h-16 w-full"}),e.jsx(x,{className:"h-20 w-full"})]})]},s))}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:b.map(s=>e.jsxs(c,{className:"cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>g(s.catalog_path),role:"button",tabIndex:0,onKeyDown:r=>r.key==="Enter"&&g(s.catalog_path),children:[e.jsxs(p,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx("div",{className:$[s.id]??"text-foreground",children:S[s.id]??e.jsx(j,{className:"w-5 h-5"})}),s.name]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Purpose"}),e.jsx(f,{className:"text-sm leading-relaxed mt-0",children:s.description})]})]}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Model Type"}),e.jsx(v,{variant:"secondary",children:s.model_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Unity Catalog"}),e.jsx("code",{className:"text-xs bg-muted px-2 py-1 rounded block font-mono break-all",children:s.catalog_path})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:["Features (",s.features.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.features.map(r=>e.jsx(v,{variant:"outline",className:"text-xs",children:r},r))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Performance Metrics"}),(s.metrics?.length??0)>0?e.jsx("div",{className:"grid grid-cols-2 gap-2",children:(s.metrics??[]).map(r=>e.jsxs("div",{className:"bg-muted/50 px-2 py-1.5 rounded text-center",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:r.name}),e.jsx("p",{className:"text-sm font-semibold",children:r.value})]},r.name))}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No metrics from last run. Open MLflow or Model Registry for latest run metrics."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",onClick:r=>r.stopPropagation(),children:[e.jsxs(l,{variant:"default",size:"sm",className:"flex-1 min-w-0",onClick:()=>g(s.catalog_path),children:["Open in Model Registry",e.jsx(o,{className:"w-3 h-3 ml-2"})]}),e.jsxs(l,{variant:"outline",size:"sm",className:"flex-1 min-w-0",onClick:()=>w("train_models"),children:[e.jsx(h,{className:"w-4 h-4 mr-2"}),"Training Notebook",e.jsx(o,{className:"w-3 h-3 ml-2"})]})]})]})]},s.id))}),e.jsxs(c,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(i()?`${i()}/sql/dashboards/financial_impact`:void 0),role:"button",tabIndex:0,onKeyDown:s=>{s.key==="Enter"&&t(i()?`${i()}/sql/dashboards/financial_impact`:void 0)},children:[e.jsxs(p,{children:[e.jsx(u,{className:"text-lg",children:"Combined business impact"}),e.jsx(f,{children:"Together, approval propensity, risk scoring, smart routing, and smart retry drive higher approval rates, fewer false declines, and better recovery. View the Financial Impact and Smart Routing dashboards in Databricks for real metrics from your workspace."})]}),e.jsx(d,{onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>t(i()?`${i()}/sql/dashboards/financial_impact`:void 0),children:["Financial Impact dashboard",e.jsx(o,{className:"w-3 h-3 ml-2"})]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>t(i()?`${i()}/sql/dashboards/routing_optimization`:void 0),children:["Smart Routing dashboard",e.jsx(o,{className:"w-3 h-3 ml-2"})]})]})})]}),e.jsxs(c,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>t(N()),role:"button",tabIndex:0,onKeyDown:s=>{s.key==="Enter"&&t(N())},children:[e.jsxs(p,{children:[e.jsx(u,{className:"text-lg",children:"Model Training Pipeline"}),e.jsx(f,{children:"Automated training workflow (Setup & Run step 7). All four models are RandomForestClassifier; trained in one MLflow experiment and registered to Unity Catalog."})]}),e.jsx(d,{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-semibold",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Data Loading"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Loads training data from Unity Catalog Silver table (payments_enriched_silver, last 30 days)"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-semibold",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Feature Engineering"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Per-model feature sets; missing values filled, categoricals encoded (e.g. decline_reason, merchant_segment one-hot)"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-semibold",children:"3"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Model Training & Evaluation"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Trains four RandomForestClassifier models (approval propensity, risk scoring, smart routing, smart retry), train/test split, logs params and metrics to MLflow"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-xs font-semibold",children:"4"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Unity Catalog Registration"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Registers each model to UC with signature (approval_propensity_model, risk_scoring_model, smart_routing_policy, smart_retry_policy) for serving and Decisioning"})]})]})]})})]})]})}const O=()=>e.jsx(q,{});export{O as component};
