# =============================================================================
# Lakebase (Databricks managed Postgres) - required for UI CRUD and ML features
# =============================================================================
# Rules, experiments, incidents, and ML features in the app use this database.
# See: https://www.databricks.com/product/lakebase
#      https://learn.microsoft.com/en-us/azure/databricks/oltp/instances/create/
#
# Prefer Lakebase Autoscaling (autoscaling compute, scale-to-zero, branching):
#   Create a project in the Lakebase UI or via Terraform (databricks_postgres_project),
#   then set bundle vars: lakebase_project_id, lakebase_branch_id, lakebase_endpoint_id.
#   The notebook and app use the Postgres API (ws.postgres) when these are set.
#
# Fallback: Lakebase Provisioned (database_instances below). App uses PGAPPNAME when
# Autoscaling vars are not set. Bind the app to this DB in resources/fastapi_app.yml if desired.
# =============================================================================

resources:
  database_instances:
    payment_analysis_db:
      name: ${var.lakebase_instance_name}
      capacity: ${var.lakebase_capacity}

  database_catalogs:
    payment_analysis_lakebase_catalog:
      database_instance_name: ${var.lakebase_instance_name}
      name: ${var.lakebase_uc_catalog_name}
      database_name: ${var.lakebase_database_name}
      create_database_if_not_exists: true
