# =============================================================================
# Unity Catalog - Schema and Volumes
# =============================================================================
# Single schema and four managed volumes for the payment analysis platform.
# Catalog and schema names come from variables (default or set at deploy).
# Tables/views are created by Lakeflow and gold view job; ML models by ML job.
# =============================================================================

resources:
  schemas:
    payment_analysis_schema:
      name: ${var.schema}
      catalog_name: ${var.catalog}
      comment: |
        Payment Approval Analysis Platform (${var.environment}).
        Bronze: raw events. Silver: enriched transactions. Gold: v_* analytical views.
        ML models. Agent tool functions (AgentBricks) live here too (catalog.schema.get_*).
      grants:
        - principal: users
          privileges: [USE_SCHEMA, SELECT, EXECUTE]
        - principal: ${workspace.current_user.userName}
          privileges: [ALL_PRIVILEGES]

  volumes:
    raw_data_volume:
      name: raw_data
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      volume_type: MANAGED
      comment: "Landing zone for raw payment data files (CSV, JSON, Parquet)"

    checkpoints_volume:
      name: checkpoints
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      volume_type: MANAGED
      comment: "Checkpoint storage for Structured Streaming and Lakeflow"

    ml_artifacts_volume:
      name: ml_artifacts
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      volume_type: MANAGED
      comment: "ML model artifacts, feature store, and training data"

    reports_volume:
      name: reports
      catalog_name: ${var.catalog}
      schema_name: ${var.schema}
      volume_type: MANAGED
      comment: "Generated reports, dashboard exports, and analytics outputs"
